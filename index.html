<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Inventori Sederhana â€” HTML Saja</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #0b1220; }
    .navbar, .card-header { background: #0b1220; color: #fff; }
    .card { border: 1px solid #24324a; background: #0f172a; color: #cbd5e1; }
    .table { color: #cbd5e1; }
    .table thead th { color: #93c5fd; }
    .form-control, .form-select { background:#0b1220; border-color:#24324a; color:#e2e8f0; }
    .form-control::placeholder { color:#64748b; }
    .btn-outline-secondary, .btn-outline-danger, .btn-outline-primary { border-color:#334155; color:#e2e8f0; }
    .btn-outline-secondary:hover, .btn-outline-danger:hover, .btn-outline-primary:hover { background:#1f2937; }
    .toast { background:#0f172a; color:#e2e8f0; border:1px solid #334155; }
    a.nav-link { cursor: pointer; }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand fw-semibold" href="#">ðŸ“¦ Inventori</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample" aria-controls="navbarsExample" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarsExample">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#transaksi">Transaksi</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#database">Database</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#pengaturan">Pengaturan</a></li>
      </ul>
    </div>
  </div>
</nav>

<main class="container my-4">
  <div class="tab-content">
    <!-- Transaksi -->
    <section class="tab-pane fade show active" id="transaksi">
      <div class="row g-3">
        <div class="col-lg-5">
          <div class="card h-100">
            <div class="card-header">Masuk / Keluar Barang</div>
            <div class="card-body">
              <form id="formTransaksi" class="row g-3">
                <div class="col-12">
                  <label class="form-label">Jenis Transaksi</label>
                  <div class="d-flex gap-3">
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="tipe" id="tipeMasuk" value="Masuk" checked>
                      <label class="form-check-label" for="tipeMasuk">Masuk</label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="tipe" id="tipeKeluar" value="Keluar">
                      <label class="form-check-label" for="tipeKeluar">Keluar</label>
                    </div>
                  </div>
                </div>
                <div class="col-12">
                  <label for="kodeBarang" class="form-label">Kode / Art. No</label>
                  <input type="text" class="form-control" id="kodeBarang" placeholder="Contoh: ART-001" required list="listArtNo">
                  <datalist id="listArtNo"></datalist>
                </div>
                <div class="col-12">
                  <label for="namaBarang" class="form-label">Nama / Deskripsi</label>
                  <input type="text" class="form-control" id="namaBarang" placeholder="Nama barang" required>
                </div>
                <div class="col-md-6">
                  <label for="unitBarang" class="form-label">Unit (D-Unit)</label>
                  <input type="text" class="form-control" id="unitBarang" placeholder="pcs / box / kg" required>
                </div>
                <div class="col-md-6">
                  <label for="qtyBarang" class="form-label">Qty</label>
                  <input type="number" class="form-control" id="qtyBarang" min="1" step="1" required>
                </div>
                <div class="col-md-6">
                  <label for="hargaBarang" class="form-label">Harga Aktual (opsional)</label>
                  <input type="number" class="form-control" id="hargaBarang" min="0" step="0.01" placeholder="IDR">
                  <div class="form-text">Jika diisi, harga akan memperbarui <em>Actual-Price</em> item.</div>
                </div>
                <div class="col-12">
                  <button type="submit" class="btn btn-primary w-100">Simpan Transaksi</button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <div class="col-lg-7">
          <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
              <span>Riwayat Transaksi</span>
              <div class="d-flex gap-2">
                <button class="btn btn-sm btn-outline-secondary" id="btnExportTransaksi">Export JSON</button>
                <label class="btn btn-sm btn-outline-secondary mb-0">
                  Import <input type="file" id="importTransaksi" hidden accept="application/json">
                </label>
              </div>
            </div>
            <div class="card-body table-responsive">
              <table class="table table-sm align-middle" id="tabelTransaksi">
                <thead>
                  <tr>
                    <th>Tanggal</th>
                    <th>Jenis</th>
                    <th>Art. No</th>
                    <th>Deskripsi</th>
                    <th>Unit</th>
                    <th>Qty</th>
                    <th>Harga</th>
                    <th>Jumlah</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Database -->
    <section class="tab-pane fade" id="database">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <span>Master Database</span>
          <div class="d-flex gap-2">
            <button class="btn btn-sm btn-outline-secondary" id="btnExportDB">Export JSON</button>
            <label class="btn btn-sm btn-outline-secondary mb-0">
              Import <input type="file" id="importDB" hidden accept="application/json">
            </label>
          </div>
        </div>
        <div class="card-body">
          <form id="formItem" class="row g-3">
            <div class="col-md-3">
              <label class="form-label">Art. No</label>
              <input type="text" class="form-control" id="artNo" required>
            </div>
            <div class="col-md-3">
              <label class="form-label">Description</label>
              <input type="text" class="form-control" id="description" required>
            </div>
            <div class="col-md-2">
              <label class="form-label">D-Unit</label>
              <input type="text" class="form-control" id="dUnit" required>
            </div>
            <div class="col-md-2">
              <label class="form-label">Actual-Price</label>
              <input type="number" class="form-control" id="actualPrice" min="0" step="0.01" required>
            </div>
            <div class="col-md-2">
              <label class="form-label">SOH QTY</label>
              <input type="number" class="form-control" id="sohQty" min="0" step="1" required>
            </div>
            <div class="col-md-2">
              <label class="form-label">Req QTY</label>
              <input type="number" class="form-control" id="reqQty" min="0" step="1" value="0">
            </div>
            <div class="col-md-2">
              <label class="form-label">Min Stock</label>
              <input type="number" class="form-control" id="minStock" min="0" step="1" value="0">
            </div>
            <div class="col-md-2">
              <label class="form-label">Max Stock</label>
              <input type="number" class="form-control" id="maxStock" min="0" step="1" value="0">
            </div>
            <div class="col-md-4">
              <label class="form-label">Supplier Name</label>
              <input type="text" class="form-control" id="supplierName">
            </div>
            <div class="col-12 d-flex gap-2">
              <button type="submit" class="btn btn-success">Simpan / Update Item</button>
              <button type="button" id="btnResetForm" class="btn btn-outline-secondary">Reset</button>
              <button type="button" id="btnHapusItem" class="btn btn-outline-danger">Hapus Item</button>
            </div>
          </form>

          <hr>
          <div class="table-responsive">
            <table class="table table-hover table-sm align-middle" id="tabelDB">
              <thead>
                <tr>
                  <th>Art. No</th>
                  <th>Description</th>
                  <th>D-Unit</th>
                  <th>Actual-Price</th>
                  <th>SOH QTY</th>
                  <th>Actual Amount (SOH)</th>
                  <th>Req QTY</th>
                  <th>Actual Amount (Request)</th>
                  <th>Min Stock</th>
                  <th>Max Stock</th>
                  <th>Supplier Name</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- Pengaturan -->
    <section class="tab-pane fade" id="pengaturan">
      <div class="card">
        <div class="card-header">Pengaturan & Data</div>
        <div class="card-body">
          <div class="d-flex flex-wrap gap-2">
            <button id="btnBackupSemua" class="btn btn-outline-primary">Backup Semua (JSON)</button>
            <button id="btnRestoreContoh" class="btn btn-outline-secondary">Muat Data Contoh</button>
            <button id="btnHapusSemua" class="btn btn-outline-danger">Hapus Semua Data</button>
          </div>
          <p class="mt-3 text-muted small">
            Data disimpan di browser Anda (localStorage). Gunakan export/import untuk berbagi atau pindah perangkat.
          </p>
        </div>
      </div>
    </section>
  </div>
</main>

<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div id="appToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header">
      <strong class="me-auto">Inventori</strong>
      <small>just now</small>
      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
const APP_KEY = 'inventori_v1';
const TX_KEY  = 'inventori_tx_v1';
const state = { db: [], tx: [] };

const fmtIDR = (n) => (n ?? 0).toLocaleString('id-ID', { style: 'currency', currency: 'IDR' });
const qs = (sel, el=document) => el.querySelector(sel);
const qsa = (sel, el=document) => [...el.querySelectorAll(sel)];

function load() {
  try { state.db = JSON.parse(localStorage.getItem(APP_KEY)) || [];
        state.tx = JSON.parse(localStorage.getItem(TX_KEY)) || []; }
  catch { state.db = []; state.tx = []; }
}
function save() {
  localStorage.setItem(APP_KEY, JSON.stringify(state.db));
  localStorage.setItem(TX_KEY, JSON.stringify(state.tx));
}
function toast(msg) {
  const t = qs('#appToast');
  qs('.toast-body', t).textContent = msg;
  new bootstrap.Toast(t, { delay: 2000 }).show();
}

function recalcAndRender() { renderDatalist(); renderDBTable(); renderTxTable(); }
function renderDatalist() {
  const dl = qs('#listArtNo');
  dl.innerHTML = state.db.map(it => \`<option value="\${it.artNo}">\${it.description}</option>\`).join('');
}
function computeAmounts(it) {
  const actualAmountSOH = (Number(it.actualPrice) || 0) * (Number(it.sohQty) || 0);
  const actualAmountReq = (Number(it.actualPrice) || 0) * (Number(it.reqQty) || 0);
  return { actualAmountSOH, actualAmountReq };
}
function renderDBTable() {
  const tbody = qs('#tabelDB tbody');
  tbody.innerHTML = state.db.map(it => {
    const { actualAmountSOH, actualAmountReq } = computeAmounts(it);
    const lowClass = (Number(it.sohQty) <= Number(it.minStock)) ? 'table-danger' : '';
    return \`<tr class="\${lowClass}" data-artno="\${it.artNo}">
      <td>\${it.artNo}</td>
      <td>\${it.description}</td>
      <td>\${it.dUnit}</td>
      <td>\${fmtIDR(Number(it.actualPrice) || 0)}</td>
      <td>\${Number(it.sohQty) || 0}</td>
      <td>\${fmtIDR(actualAmountSOH)}</td>
      <td>\${Number(it.reqQty) || 0}</td>
      <td>\${fmtIDR(actualAmountReq)}</td>
      <td>\${Number(it.minStock) || 0}</td>
      <td>\${Number(it.maxStock) || 0}</td>
      <td>\${it.supplierName || ''}</td>
    </tr>\`;
  }).join('');
  qsa('#tabelDB tbody tr').forEach(tr => {
    tr.addEventListener('click', () => {
      const artNo = tr.getAttribute('data-artno');
      const it = state.db.find(x => x.artNo === artNo);
      if (it) fillFormItem(it);
    });
  });
}
function renderTxTable() {
  const tbody = qs('#tabelTransaksi tbody');
  tbody.innerHTML = state.tx.slice().reverse().map(tx => {
    const amount = (Number(tx.harga) || 0) * (Number(tx.qty) || 0);
    return \`<tr>
      <td>\${new Date(tx.tanggal).toLocaleString('id-ID')}</td>
      <td>\${tx.tipe}</td>
      <td>\${tx.artNo}</td>
      <td>\${tx.description || ''}</td>
      <td>\${tx.unit || ''}</td>
      <td>\${tx.qty}</td>
      <td>\${tx.harga != null ? fmtIDR(Number(tx.harga)) : '-'}</td>
      <td>\${amount ? fmtIDR(amount) : '-'}</td>
    </tr>\`;
  }).join('');
}

function fillFormItem(it) {
  qs('#artNo').value = it.artNo;
  qs('#description').value = it.description;
  qs('#dUnit').value = it.dUnit;
  qs('#actualPrice').value = it.actualPrice ?? 0;
  qs('#sohQty').value = it.sohQty ?? 0;
  qs('#reqQty').value = it.reqQty ?? 0;
  qs('#minStock').value = it.minStock ?? 0;
  qs('#maxStock').value = it.maxStock ?? 0;
  qs('#supplierName').value = it.supplierName ?? '';
}
function getFormItem() {
  return {
    artNo: qs('#artNo').value.trim(),
    description: qs('#description').value.trim(),
    dUnit: qs('#dUnit').value.trim(),
    actualPrice: Number(qs('#actualPrice').value || 0),
    sohQty: Number(qs('#sohQty').value || 0),
    reqQty: Number(qs('#reqQty').value || 0),
    minStock: Number(qs('#minStock').value || 0),
    maxStock: Number(qs('#maxStock').value || 0),
    supplierName: qs('#supplierName').value.trim()
  };
}
function upsertItem(item) {
  const idx = state.db.findIndex(x => x.artNo === item.artNo);
  if (idx >= 0) state.db[idx] = item; else state.db.push(item);
  save(); recalcAndRender();
}

function setupFormItemHandlers() {
  qs('#formItem').addEventListener('submit', (e) => {
    e.preventDefault();
    const item = getFormItem();
    if (!item.artNo || !item.description) return toast('Lengkapi Art. No dan Description');
    if (item.maxStock && item.minStock && item.maxStock < item.minStock) return toast('Max Stock tidak boleh < Min Stock');
    upsertItem(item); toast('Item disimpan.');
  });
  qs('#btnResetForm').addEventListener('click', () => qs('#formItem').reset());
  qs('#btnHapusItem').addEventListener('click', () => {
    const artNo = qs('#artNo').value.trim();
    if (!artNo) return toast('Pilih item untuk dihapus.');
    const before = state.db.length;
    state.db = state.db.filter(x => x.artNo !== artNo);
    if (state.db.length < before) { save(); recalcAndRender(); toast('Item dihapus.'); }
    else toast('Item tidak ditemukan.');
  });
}

function setupTransaksiHandlers() {
  const f = qs('#formTransaksi');
  f.addEventListener('submit', (e) => {
    e.preventDefault();
    const tipe = qs('input[name="tipe"]:checked').value;
    const artNo = qs('#kodeBarang').value.trim();
    const desc  = qs('#namaBarang').value.trim();
    const unit  = qs('#unitBarang').value.trim();
    const qty   = Number(qs('#qtyBarang').value);
    const harga = qs('#hargaBarang').value ? Number(qs('#hargaBarang').value) : null;
    if (!artNo || !desc || !unit || !qty || qty <= 0) return toast('Lengkapi data transaksi.');

    let it = state.db.find(x => x.artNo === artNo);
    if (!it) {
      it = { artNo, description: desc, dUnit: unit, actualPrice: Number(harga) || 0, sohQty: 0, reqQty: 0, minStock: 0, maxStock: 0, supplierName: '' };
      state.db.push(it);
    } else {
      it.description = desc;
      it.dUnit = unit;
      if (harga != null) it.actualPrice = Number(harga);
    }
    if (tipe === 'Masuk') it.sohQty = Number(it.sohQty || 0) + qty;
    else { it.sohQty = Number(it.sohQty || 0) - qty; if (it.sohQty < 0) it.sohQty = 0; }

    state.tx.push({ tanggal: new Date().toISOString(), tipe, artNo, description: desc, unit, qty, harga });
    save(); recalcAndRender(); f.reset(); toast('Transaksi disimpan.');
  });
}

function download(filename, dataStr) {
  const blob = new Blob([dataStr], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = filename; a.click();
  setTimeout(() => URL.revokeObjectURL(url), 1000);
}
function setupExportImport() {
  qs('#btnExportDB').addEventListener('click', () => download('database.json', JSON.stringify(state.db, null, 2)));
  qs('#btnExportTransaksi').addEventListener('click', () => download('transaksi.json', JSON.stringify(state.tx, null, 2)));
  qs('#importDB').addEventListener('change', (e) => {
    const file = e.target.files[0]; if (!file) return;
    const r = new FileReader();
    r.onload = () => { try {
        const data = JSON.parse(r.result);
        if (Array.isArray(data)) { state.db = data; save(); recalcAndRender(); toast('Database diimpor.'); }
        else throw new Error();
      } catch { toast('Gagal impor database.'); } };
    r.readAsText(file);
  });
  qs('#importTransaksi').addEventListener('change', (e) => {
    const file = e.target.files[0]; if (!file) return;
    const r = new FileReader();
    r.onload = () => { try {
        const data = JSON.parse(r.result);
        if (Array.isArray(data)) { state.tx = data; save(); recalcAndRender(); toast('Transaksi diimpor.'); }
        else throw new Error();
      } catch { toast('Gagal impor transaksi.'); } };
    r.readAsText(file);
  });
}

function setupPengaturan() {
  qs('#btnHapusSemua').addEventListener('click', () => {
    if (!confirm('Hapus semua data?')) return;
    localStorage.removeItem(APP_KEY);
    localStorage.removeItem(TX_KEY);
    load(); recalcAndRender(); toast('Semua data dihapus.');
  });
  qs('#btnRestoreContoh').addEventListener('click', () => {
    const contoh = [
      { artNo: 'ART-001', description: 'Bolpoin Biru', dUnit: 'pcs', actualPrice: 4500, sohQty: 120, reqQty: 10, minStock: 50, maxStock: 300, supplierName: 'PT Alat Tulis' },
      { artNo: 'ART-002', description: 'Kertas A4 80gsm', dUnit: 'rim', actualPrice: 52000, sohQty: 25, reqQty: 5, minStock: 10, maxStock: 50, supplierName: 'CV Kertas Jaya' },
      { artNo: 'ART-003', description: 'Lakban Coklat 2"', dUnit: 'roll', actualPrice: 9000, sohQty: 60, reqQty: 0, minStock: 20, maxStock: 200, supplierName: 'UD Kemasan' }
    ];
    state.db = contoh; state.tx = []; save(); recalcAndRender(); toast('Data contoh dimuat.');
  });
  qs('#btnBackupSemua').addEventListener('click', () => {
    const payload = { exportedAt: new Date().toISOString(), db: state.db, tx: state.tx };
    download('backup_inventori.json', JSON.stringify(payload, null, 2));
  });
}

document.addEventListener('DOMContentLoaded', () => {
  load();
  setupFormItemHandlers();
  setupTransaksiHandlers();
  setupExportImport();
  setupPengaturan();
  recalcAndRender();
  const firstTab = new bootstrap.Tab(document.querySelector('[data-bs-toggle="tab"].active'));
  firstTab.show();
});
</script>
</body>
</html>
