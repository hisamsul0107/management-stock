
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inventory Management System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {margin: 0; padding: 0; box-sizing: border-box;}
        body {font-family: Arial, sans-serif; display: flex; background-color: #f5f7fa;}
        /* Sidebar */
        .sidebar {width: 250px; background-color: #2c3e50; height: 100vh; position: fixed; padding: 20px 0; color: #fff;}
        .sidebar h2 {text-align: center; margin-bottom: 30px;}
        .sidebar ul {list-style: none;}
        .sidebar ul li {padding: 15px 20px; cursor: pointer; transition: background 0.3s;}
        .sidebar ul li:hover, .sidebar ul li.active {background-color: #34495e;}
        /* Main */
        .main {margin-left: 250px; padding: 20px; width: calc(100% - 250px);}
        .hidden {display: none;}
        h2 {color: #2c3e50; margin-bottom: 15px;}
        form input, form button, form select, form textarea {
            padding: 10px; margin: 5px; border: 1px solid #ccc; border-radius: 4px;
        }
        form button {background-color: #3498db; color: white; cursor: pointer;}
        table {width: 100%; border-collapse: collapse; margin-top: 15px;}
        th, td {border: 1px solid #ddd; padding: 10px; text-align: center;}
        th {background-color: #3498db; color: white;}
        tr.low-stock {background-color: #ffe6e6;}
        td[contenteditable="true"] {background-color: #fdfd96;}
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <h2>ðŸ“¦ Inventory</h2>
        <ul>
            <li class="active" onclick="showPage('dashboard')">Dashboard</li>
            <li onclick="showPage('form')">Form Transaksi</li>
            <li onclick="showPage('masuk')">Data Masuk</li>
            <li onclick="showPage('keluar')">Data Keluar</li>
            <li onclick="showPage('database')">Database Barang</li>
            <li onclick="showPage('riwayat')">Riwayat Transaksi</li>
        </ul>
    </div>

    <!-- Main -->
    <div class="main">
        <!-- Dashboard -->
        <div id="dashboard">
            <h2>Dashboard</h2>
            <p>Total Barang: <span id="totalBarang">0</span></p>
            <p>Total Stok: <span id="totalStok">0</span></p>
            <canvas id="stokChart"></canvas>
        </div>

        <!-- Form Transaksi -->
        <div id="form" class="hidden">
            <h2>Form Transaksi</h2>
            <form id="transactionForm">
                <input type="text" id="kode" placeholder="Kode Barang" required />
                <input type="text" id="nama" placeholder="Nama Barang" required />
                <input type="text" id="unit" placeholder="Unit" required />
                <input type="number" id="qty" placeholder="Qty" required />
                <input type="text" id="store" placeholder="Store" required />
                <input type="text" id="keterangan" placeholder="Keterangan" />
                <input type="text" id="receiving" placeholder="No Receiving (opsional)" />
                <button type="button" onclick="addItem(true)">âž• Masuk</button>
                <button type="button" onclick="addItem(false)">âž– Keluar</button>
            </form>
            <h3>Riwayat Stok Barang</h3>
            <table id="riwayatStok">
                <thead>
                    <tr><th>Kode</th><th>Nama</th><th>Qty</th><th>Unit</th><th>Tanggal/Jam</th><th>Store</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Data Masuk -->
        <div id="masuk" class="hidden">
            <h2>Data Barang Masuk</h2>
            <table id="tableMasuk">
                <thead><tr><th>Tanggal</th><th>Kode</th><th>Nama</th><th>Qty</th><th>Store</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Data Keluar -->
        <div id="keluar" class="hidden">
            <h2>Data Barang Keluar</h2>
            <table id="tableKeluar">
                <thead><tr><th>Tanggal</th><th>Kode</th><th>Nama</th><th>Qty</th><th>Store</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Database -->
        <div id="database" class="hidden">
            <h2>Database Barang</h2>
            <table id="inventoryTable">
                <thead>
                    <tr>
                        <th>Kode</th>
                        <th>Nama Barang</th>
                        <th>D-Unit</th>
                        <th>Actual Price</th>
                        <th>SOH QTY</th>
                        <th>Amount (SOH)</th>
                        <th>Req QTY</th>
                        <th>Amount (Req)</th>
                        <th>Min Stock</th>
                        <th>Max Stock</th>
                        <th>Supplier</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- Riwayat -->
        <div id="riwayat" class="hidden">
            <h2>Riwayat Transaksi</h2>
            <table id="tableRiwayat">
                <thead>
                    <tr><th>Tanggal</th><th>Jenis</th><th>Kode</th><th>Nama</th><th>Qty</th><th>Unit</th><th>Store</th><th>Keterangan</th><th>No Receiving</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        let inventory = JSON.parse(localStorage.getItem("inventory")) || [];
        let transaksiMasuk = JSON.parse(localStorage.getItem("masuk")) || [];
        let transaksiKeluar = JSON.parse(localStorage.getItem("keluar")) || [];
        let riwayat = JSON.parse(localStorage.getItem("riwayat")) || [];

        function saveData() {
            localStorage.setItem("inventory", JSON.stringify(inventory));
            localStorage.setItem("masuk", JSON.stringify(transaksiMasuk));
            localStorage.setItem("keluar", JSON.stringify(transaksiKeluar));
            localStorage.setItem("riwayat", JSON.stringify(riwayat));
        }

        function renderTable() {
            const tbody = document.querySelector("#inventoryTable tbody");
            tbody.innerHTML = "";
            inventory.forEach(item => {
                const row = document.createElement("tr");
                if (item.soh <= 5) row.classList.add("low-stock");
                row.innerHTML = `
                    <td>${item.kode}</td>
                    <td contenteditable="true" oninput="editItem('${item.kode}', 'nama', this.innerText)">${item.nama}</td>
                    <td contenteditable="true" oninput="editItem('${item.kode}', 'unit', this.innerText)">${item.unit}</td>
                    <td contenteditable="true" oninput="editItem('${item.kode}', 'price', this.innerText)">${item.price || ''}</td>
                    <td>${item.soh}</td>
                    <td>${(item.soh * (item.price || 0)).toFixed(2)}</td>
                    <td contenteditable="true" oninput="editItem('${item.kode}', 'reqQty', this.innerText)">${item.reqQty || ''}</td>
                    <td contenteditable="true" oninput="editItem('${item.kode}', 'reqAmt', this.innerText)">${item.reqAmt || ''}</td>
                    <td contenteditable="true" oninput="editItem('${item.kode}', 'minStock', this.innerText)">${item.minStock || ''}</td>
                    <td contenteditable="true" oninput="editItem('${item.kode}', 'maxStock', this.innerText)">${item.maxStock || ''}</td>
                    <td contenteditable="true" oninput="editItem('${item.kode}', 'supplier', this.innerText)">${item.supplier || ''}</td>
                `;
                tbody.appendChild(row);
            });
            updateDashboard();
        }

        function editItem(kode, field, value) {
            const item = inventory.find(i => i.kode === kode);
            if (item) {
                item[field] = isNaN(value) ? value : parseFloat(value);
                saveData();
                renderTable();
            }
        }

        function renderMasukKeluar() {
            const masukTbody = document.querySelector("#tableMasuk tbody");
            masukTbody.innerHTML = "";
            transaksiMasuk.forEach(tr => {
                const row = `<tr><td>${tr.tanggal}</td><td>${tr.kode}</td><td>${tr.nama}</td><td>${tr.qty}</td><td>${tr.store}</td></tr>`;
                masukTbody.innerHTML += row;
            });

            const keluarTbody = document.querySelector("#tableKeluar tbody");
            keluarTbody.innerHTML = "";
            transaksiKeluar.forEach(tr => {
                const row = `<tr><td>${tr.tanggal}</td><td>${tr.kode}</td><td>${tr.nama}</td><td>${tr.qty}</td><td>${tr.store}</td></tr>`;
                keluarTbody.innerHTML += row;
            });
        }

        function renderRiwayat() {
            const tbody = document.querySelector("#tableRiwayat tbody");
            tbody.innerHTML = "";
            riwayat.forEach(tr => {
                const row = `<tr>
                    <td>${tr.tanggal}</td><td>${tr.jenis}</td><td>${tr.kode}</td><td>${tr.nama}</td>
                    <td>${tr.qty}</td><td>${tr.unit}</td><td>${tr.store}</td>
                    <td>${tr.keterangan}</td><td>${tr.receiving}</td></tr>`;
                tbody.innerHTML += row;
            });
        }

        function addItem(isIn) {
            const kode = document.getElementById("kode").value.trim();
            const nama = document.getElementById("nama").value.trim();
            const unit = document.getElementById("unit").value.trim();
            const qty = parseInt(document.getElementById("qty").value);
            const store = document.getElementById("store").value.trim();
            const keterangan = document.getElementById("keterangan").value.trim();
            const receiving = document.getElementById("receiving").value.trim();

            if (!kode || !nama || !unit || isNaN(qty) || !store) {
                alert("Lengkapi semua data!");
                return;
            }

            let item = inventory.find(i => i.kode === kode);
            if (!item) {
                item = { kode, nama, unit, soh: 0 };
                inventory.push(item);
            }

            const tanggal = new Date().toLocaleString();
            if (isIn) {
                item.soh += qty;
                transaksiMasuk.push({ tanggal, kode, nama, qty, store });
                riwayat.push({ tanggal, jenis: "Masuk", kode, nama, qty, unit, store, keterangan, receiving });
            } else {
                if (item.soh < qty) return alert("Stok tidak cukup!");
                item.soh -= qty;
                transaksiKeluar.push({ tanggal, kode, nama, qty, store });
                riwayat.push({ tanggal, jenis: "Keluar", kode, nama, qty, unit, store, keterangan, receiving });
            }

            saveData();
            renderTable();
            renderMasukKeluar();
            renderRiwayat();
            renderRiwayatStok(kode);
            document.getElementById("transactionForm").reset();
        }

        function renderRiwayatStok(kode) {
            const tbody = document.querySelector("#riwayatStok tbody");
            tbody.innerHTML = "";
            const riwayatBarang = riwayat.filter(r => r.kode === kode);
            riwayatBarang.forEach(r => {
                tbody.innerHTML += `<tr><td>${r.kode}</td><td>${r.nama}</td><td>${r.qty}</td><td>${r.unit}</td><td>${r.tanggal}</td><td>${r.store}</td></tr>`;
            });
        }

        function updateDashboard() {
            document.getElementById("totalBarang").innerText = inventory.length;
            document.getElementById("totalStok").innerText = inventory.reduce((a, b) => a + b.soh, 0);

            const ctx = document.getElementById("stokChart").getContext("2d");
            new Chart(ctx, {
                type: "bar",
                data: {
                    labels: inventory.map(i => i.nama),
                    datasets: [{
                        label: "Stok Barang",
                        data: inventory.map(i => i.soh),
                        backgroundColor: "#3498db"
                    }]
                }
            });
        }

        function showPage(id) {
            document.querySelectorAll(".main > div").forEach(div => div.classList.add("hidden"));
            document.getElementById(id).classList.remove("hidden");
            document.querySelectorAll(".sidebar ul li").forEach(li => li.classList.remove("active"));
            event.target.classList.add("active");
        }

        renderTable();
        renderMasukKeluar();
        renderRiwayat();
    </script>
</body>
</html>
